# https://testdriven.io/courses/tdd-fastapi/postgres-setup/
# to build the docker container
docker-compose build
# to run docker container and detach
docker-compose up -d
# to view the logs from web container
docker-compose logs web
# to enter psql on database
docker-compose exec web-db psql -U postgres
# to run tests
docker-compose exec web python -m pytest
# to generate schema manually
docker-compose exec web python app/db.py

# to select only tests with ping in the name:
docker-compose exec web python -m pytest -k ping

# some useful pytest commands
# normal run
docker-compose exec web python -m pytest

# disable warnings
docker-compose exec web python -m pytest -p no:warnings

# run only the last failed tests
docker-compose exec web python -m pytest --lf

# run only the tests with names that match the string expression
docker-compose exec web python -m pytest -k "summary and not test_read_summary"

# stop the test session after the first failure
docker-compose exec web python -m pytest -x

# enter PDB after first failure then end the test session
docker-compose exec web python -m pytest -x --pdb

# stop the test run after two failures
docker-compose exec web python -m pytest --maxfail=2

# show local variables in tracebacks
docker-compose exec web python -m pytest -l

# list the 2 slowest tests
docker-compose exec web python -m pytest --durations=2
